<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>RaceMann RAW messages</title>
  <style>
    body { font-family: monospace; background: #111; color: #0f0; }
    input, button { font-size: 16px; padding: 6px; }
    #log { white-space: pre-wrap; margin-top: 10px; }
  </style>
</head>
<body>

<h2>RaceMann RAW messages</h2>

<input id="raceUrl" size="80"
  placeholder="https://miks.racemann.com/Race/id/....#race" />
<button onclick="start()">START</button>

<pre id="log"></pre>

<script>
const WORKER = "https://racemann-api.vsmirnoff.workers.dev";

function log(s) {
  const el = document.getElementById("log");
  el.textContent += s + "\n";
  el.scrollTop = el.scrollHeight;
}

function start() {
  document.getElementById("log").textContent = "";

  const raceUrl = document.getElementById("raceUrl").value.trim();
  if (!raceUrl) return alert("raceUrl required");

  const es = new EventSource(
    `${WORKER}/stream?raceUrl=${encodeURIComponent(raceUrl)}`
  );

  es.onmessage = (e) => {
    try {
      const j = JSON.parse(e.data);
      log(JSON.stringify(j, null, 2));
    } catch {
      log(e.data);
    }
  };

  es.onerror = () => {
    log("‚ùå stream error / closed");
    es.close();
  };
}
</script>

</body>
</html>